# Оптимизация Rails приложения
Во время работы приложения было выявлено ряд проблем.
1.  Загрузка данных в базу через `rake reload_json[fixtures/large.json]` происходит очень медленно
2.  При отображении страницы расписаний наблюдается падение скорости отдачи страницы пропорционально размеру отдаваемых данных. 

## Проблема №1
##### Импорт json данных в БД. Бюджет не более 1 минуты при загрузки файла `fixtures/large.json`

#### Снимаем метрику

*использовался rspec benchmark. Учитываем, что цифры будут не много завышаны на запуск теста*

| File   |    Finished in |
|:------:|:--------------:|
| small  |       8.49 sec | 
| medium | 1 min 9.43 sec | 
| large  |    не дождался | 

#### Решение
Для импорта данных воспользуемся библиотекой `activerecord-import`

Что бы понять что вообще происходит нарисовал ERD
![erd](https://raw.githubusercontent.com/VidgarVii/rails-optimization-2-task3/optimize/ERD.png)

####Выявил ряд проблем
* Таблица services лишняя. Запись/обновление/удаление производиться не будет. Значит смело можно удалять таблицу и модель. А данные засунуть как минимум в массив. Тем более их мало. А в таблице будем Bus будем хранить массив индексов сервисов. Соответственно львинная доля запросов уйдет сама. Минус этого усложниться логика в представлениях. И мб проще и быстрее в массиве сразу хранить строки. Пока не знаю. Тесты покажут.

* В модели Bus колонка model имее так же статические данные. Изменим тип данных на int. И воспользуемся макросом Enum.
![erd](https://raw.githubusercontent.com/VidgarVii/rails-optimization-2-task3/optimize/ERD2.png)

После того как таск был переписан с помощью activerecord-import. Результаты теста стали такие

####Результаты

| File   |    Finished in |
|:------:|:--------------:|
| small  |       1.42 sec | 
| medium |      11.74 sec | 
| large  |    2 min 5 sec | 

По крайней мере я дождался. В бюджет не уложился. Оптимизируем дальше.


